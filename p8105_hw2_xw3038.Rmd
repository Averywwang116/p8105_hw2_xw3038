---
title: "Homework2"
author: "Avery Wang"
date: 2024-10-01
output: github_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, message = FALSE)
```

## Problem 1
Load the necessary packages for this assignment 
```{r load_libraries}
library(tidyverse)
library(dplyr)
library(readxl)

```

Read and clean the data; retain line, station, name, station latitude / longitude, routes served, entry, vending, entrance type, and ADA compliance. Convert the entry variable from character (YES vs NO) to a logical variable (the ifelse or case_match function may be useful).

```{r}
#load the data using relative path
NYC_subway=read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv",
                    col_types = cols(Route8 =col_character(), 
                                     Route9 = col_character(), 
                                     Route10 =col_character(), 
                                     Route11 = col_character())) |>
  janitor::clean_names() |> 
  select(line:exit_only,vending,ada) |>
  mutate(entry = ifelse(entry == "YES", TRUE, FALSE))
head(NYC_subway,5)
```
The variables include:
Line, station name, station latitude and longtitude, route 1 to 11, entrance type, entry, exit_only and ada information.

The first step is to convert the Route8 to 11 into character type so that all the types of Route are now consistent. Then the `janitor::clean_names()` is used to standardize the column names. And specific columns according to the instruction are selected. Then the entry variable is converted to the logical variable using ifelse. The cleaned dataset now has `r nrow(NYC_subway)` rows and `r ncol(NYC_subway)` columns. And these data are not tidy as we should convert `route` variables from wide to long format. 

```{r}
filter_station=select(NYC_subway,line,station_name,ada,entry,vending)

```
* There are `r nrow(filter_station|>distinct(line, station_name))` distinct stations 

* There are `r nrow(filter_station |> filter(ada == TRUE) |> distinct(line, station_name))` stations that are ADA compliant

```{r}
# Filter for stations without vending machines
without_vending=nrow( filter_station |>
  filter(vending == "NO") )

# Calculate the proportion of entrances without vending machines that allow entry
noentry_without_vending=nrow( filter_station |>
  filter(vending == "NO" & entry=="TRUE") )

```

*The proportion of station entrances / exits without vending allow entrance is `r noentry_without_vending/without_vending`

Reformat data so that route number and route name are distinct variables. 
```{r}
reformat_df=
  NYC_subway |>
  mutate(across(starts_with("route"), as.character)) |>
  pivot_longer(
    route1:route11, 
    names_to = "route_number", 
    values_to = "route_name", 
    values_drop_na = TRUE
    )
```

```{r}
A_station=reformat_df|>filter(route_name == "A")|>distinct(line,station_name)
A_train_ada= reformat_df|>filter(route_name == "A"& ada=="TRUE")|>distinct(line,station_name)
```
* There are `r nrow(A_station)` distinct stations served the A train.
* There are `r nrow(A_train_ada)` distinct A stations that are ADA compliant

## Problem 2
Read and clean the Mr. Trash Wheel Sheet:
Load the excel using `read_excel` and specify the Mr. Trash Wheel sheet and figure out some potential NA cases. Then the `janitor::clean_names()` is used to standardize the column names. The rows without dumspter specific data are dropped the sports ball column is converted to the integer variable using `as.integer`. In order to differentiate the trash wheel type and help prepare the steps for combining, a column named trash_wheel is also added. And the year is converted to integer as well.

The sheet Professor trash wheel and Gwynndan trash wheel are loaded and cleaned similarly
```{r }
#load the Mr. Trash sheet by specifying the excel file
Mr_trash_wheel_sheet=read_excel("data/Trash_Wheel_Collection_Data.xlsx",
                                sheet = "Mr. Trash Wheel", 
                                na = c("NA", ".", "")) |>
   janitor::clean_names() |> #give reasonable name 
   select(dumpster:homes_powered)|>
   drop_na(dumpster)|> #remove the rows without dumpster specific data
   mutate(sports_balls = as.integer(round(sports_balls)),
          trash_wheel= "Mr. Trash Wheel", 
          year = as.integer(year))

Professor_trash_wheel_sheet=read_excel("data/Trash_Wheel_Collection_Data.xlsx",
                                sheet = "Professor Trash Wheel",
                                na = c("NA", ".", "")) |>
   janitor::clean_names() |> #give reasonable name 
   select(dumpster:homes_powered)|>
   drop_na(dumpster) |> #remove the rows without dumpster specific data
   mutate(trash_wheel ="Professor trash wheel",
           year = as.integer(year))

Gwynnda_trash_wheel=read_excel("data/Trash_Wheel_Collection_Data.xlsx",
                                sheet = "Gwynnda Trash Wheel",
                                na = c("NA", ".", "")) |>
   janitor::clean_names() |> #give reasonable name 
   select(dumpster:homes_powered)|>
   drop_na(dumpster) |> #remove the rows without dumpster specific data
   mutate(trash_wheel ="Gwynnda trash wheel",
           year = as.integer(year))


```

* Mr. trash wheel sheet has `r nrow(Mr_trash_wheel_sheet)` rows and `r ncol(Mr_trash_wheel_sheet)` columns. With the variables: `r names(Mr_trash_wheel_sheet)`

* Professor trash wheel sheet has `r nrow(Professor_trash_wheel_sheet)` rows and `r ncol(Professor_trash_wheel_sheet)` columns. With the variables: `r names(Professor_trash_wheel_sheet)`

* Gwynnda trash wheel sheet has `r nrow(Gwynnda_trash_wheel)` rows and `r ncol(Gwynnda_trash_wheel)` columns. With the variables: `r names(Gwynnda_trash_wheel)`

Then combine the dataset with `bind_rows` :
```{r}
# Combine all three datasets into one tidy dataset
combined_trash_wheel_data <- bind_rows(Mr_trash_wheel_sheet, Professor_trash_wheel_sheet, Gwynnda_trash_wheel)
head(combined_trash_wheel_data,5)
  
```
```{r}
weight_Professor=combined_trash_wheel_data |> 
  select(year,month,weight_tons,trash_wheel)|>
  filter(trash_wheel=="Professor trash wheel")


cigg_gwy=combined_trash_wheel_data |> 
  select(year,month,cigarette_butts,trash_wheel)|>
  filter(trash_wheel=="Gwynnda trash wheel", year==2022, month=="June")

```

The new dataset has `r nrow(combined_trash_wheel_data)` observations and `r ncol(combined_trash_wheel_data)` columns. With key variables: `r names(combined_trash_wheel_data)`. 

* The total trash weight collected by Professor Trash Wheel is `r sum(weight_Professor$weight_tons, na.rm = TRUE)` tons.

* The total number of cigarette butts collected by Gwynnda in June of 2022 is `r format(sum(cigg_gwy$cigarette_butts,na.rm = TRUE))`


## Problem 3